{"version":3,"file":"index.js","sources":["../node_modules/style-inject/dist/style-inject.es.js","../src/Util.js","../src/index.js"],"sourcesContent":["function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","const Util = {\n  timeFormat: function(seconds){\n    var ss = parseInt(seconds)// 秒     \n    var mm = 0 // 分        \n    var hh = 0 // 小时        \n    if (ss > 60) {         \n      mm = parseInt(ss / 60)         \n      ss = parseInt(ss % 60)       \n    }        \n    if (mm > 60) {         \n      hh = parseInt(mm / 60)         \n      mm = parseInt(mm % 60)        \n    }        \n    var result = ('00' + parseInt(ss)).slice(-2)      \n    if (mm > 0) {          \n      result = ('00' + parseInt(mm)).slice(-2) + ':' + result      \n    } else {       \n      result = '00:' + result     \n    }       \n    if (hh > 0) {        \n      result = ('00' + parseInt(hh)).slice(-2) + ':' + result        \n    }        \n    \n    return result\n  }\n}\n\nexport default Util;","import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\n\nimport './styles.scss';\nimport Util from './Util.js';\n\n// 返回image 对象<img src=\"\">\nimport dPauseIcon from './images/pause.png';\nimport dPlayIcon from './images/playing.gif';\n\n\nexport default class OAudioPlayer extends Component {\n\n  constructor(props) {\n    super(props);\n    this.audioPlayerRef = React.createRef();  \n    this.progressBarDetailRef = React.createRef();\n  }\n\n  static defaultProps = {\n    onPlaying: () => { },\n    onPause: () => { },\n    autoplay:false,\n    loop: false,\n    preload:'metadata',\n    pauseIcon: dPauseIcon.src,\n    playingIcon: dPlayIcon.src,\n  }\n\n  static propTypes = {\n    autoplay: PropTypes.bool, // 是否自动播放\n    loop: PropTypes.bool,     // 是否循环播放\n    muted: PropTypes.bool,    // 是否静音，默认为false，表示有声音\n\n    // autoplay 属性优先于 preload 假如用户想自动播放视频，那么很明显浏览器需要下载视频。\n    preload: PropTypes.string, // 加载方式 none 不缓存，metadata 获取元数据 (例如音频长度) auto 预加载\n    volume: PropTypes.string,  //音频播放的音量。值从0.0 (无声) 到 1.0 (最大声).\n    url: PropTypes.string,     //src属性，可用source标签替代\n\n    title: PropTypes.string,\n    subtitle: PropTypes.string,\n    pauseIcon:PropTypes.string,\n    playingIcon:PropTypes.string,\n    // 事件\n    onPlaying: PropTypes.func,  // 在媒体开始播放时触发（不论是初次播放、在暂停后恢复、或是在结束后重新开始）\n    onPause: PropTypes.func     // 当音频/视频已暂停时\n    \n  }\n\n  state = {\n    currentTime:\"00:00\",\n    duration:\"00:00\",\n    currentTimeNum:0,\n    durationNum:1, // 0 不能为除数，故设为1\n    bufferedPercent:0,\n    playSrc: dPauseIcon.src\n  }\n\n  componentDidMount() {\n    /******* TODO，进度条拖动\n    dragPoint.addEventListener('touchstart', (e) => this.dragStart(e), false);\n    dragPoint.addEventListener('touchmove', (e) => this.dragMove(e), false);\n    dragPoint.addEventListener('touchend', (e) => this.dragEnd(e), false);\n    //拖动开始时，可以暂停播放。拖动时计算currentTime。拖动结束继续播放,注意暂停和继续播放时间不能太短，否则报错\n    */\n  }\n\n\n  // 播放或暂停\n  audioPlayPause = () => {\n    const self = this.audioPlayerRef.current;\n    console.log(\"duration:\" + self.duration);\n    if (self.paused) {\n      console.log(\"play()\");\n      self.play();\n    } else {\n      console.log(\"pause()\");\n      self.pause();\n    }\n  }\n\n  // 播放\n  audioPlay(){\n    const self = this.audioPlayerRef.current;\n    self.play();\n  }\n\n  // 暂停\n  audioPause(){\n    const self = this.audioPlayerRef.current;\n    self.pause();\n  }\n\n  // 音频可以播放时，此时可以获取到视频的时长\n  canplayHandle = ()=>{\n    this.setState({\n      durationNum:this.audioPlayerRef.current.duration,\n      duration: Util.timeFormat(this.audioPlayerRef.current.duration)\n    })\n  }\n\n  // currentTime 当前播放位置（以秒计）变化时触发\n  timeUpdateHandle = ()=>{\n    let audioPlayer = this.audioPlayerRef.current;\n    let ct = audioPlayer.currentTime;\n    let dt = audioPlayer.duration;\n    if(ct<=dt){\n      this.setState({\n        currentTimeNum: ct,\n        currentTime: Util.timeFormat(ct)\n      })\n    }\n\n    // 动态\n    if(audioPlayer.paused){\n      this.setState({\n        playSrc:this.props.pauseIcon\n      })\n    }else{\n      this.setState({\n        playSrc:this.props.playingIcon\n      })\n    }\n    \n  }\n\n  progressBarClickHandle = (e)=>{\n    const ev = e.nativeEvent;\n    const offset = ev.layerX || ev.offsetX;\n    const progressBarDetail = this.progressBarDetailRef.current;\n    const barWidth = progressBarDetail.offsetWidth;\n    let curTime = offset/barWidth * this.state.durationNum;\n    this.setState({\n      currentTimeNum: curTime,\n      currentTime: Util.timeFormat(curTime)\n    })\n    // 设置当前播放时间\n    this.audioPlayerRef.current.currentTime  = curTime;\n\n  }\n\n\n\n  render() {\n    const {\n      url, title, subtitle, loop, onPlaying, onPause,preload,autoplay\n    } = this.props\n    const {\n       duration,currentTime,durationNum,currentTimeNum,bufferedPercent,playSrc\n    } = this.state;\n    return (\n      <div className=\"audio-player-wrap\">\n        <audio className=\"wx-audio-content\"\n          ref={this.audioPlayerRef}\n          preload = {preload}\n          autoPlay = {autoplay}\n          onPlaying={onPlaying}\n          onPause={onPause}\n          onCanPlay = { this.canplayHandle }\n          onTimeUpdate = { this.timeUpdateHandle}\n          src={url}\n          loop = {loop}>\n          \n        </audio>\n        <div className=\"player-body\">\n          <div className=\"body-left\">\n            <img onClick={this.audioPlayPause} className=\"wx-audio-state\" src={ playSrc } />\n          </div>\n          <div className=\"body-right\">\n            <p className=\"audio-title\">{title}</p>\n            <p className=\"audio-subtitle\">{subtitle}</p>\n            <div className=\"audio-progress-bar-wrap\">\n              <div className=\"progress-bar-detail\"\n                 onClick={this.progressBarClickHandle }\n                 ref={this.progressBarDetailRef}>\n                 {/* progress-bar-buffer: 缓冲进度条，progress-bar-current 播放进度条，progress-bar-loading 加载进度条 */}\n                <div className=\"progress-bar-buffer\" style={{ width: bufferedPercent + '%' }}></div>\n                <div className=\"progress-bar-current\" style={{ width: `calc((${currentTimeNum}/${durationNum})*100%)` }}></div>\n                <span className=\"progress-bar-loading\">\n                  <span className=\"loading-line\"></span>\n                </span>\n              </div>\n              <div className=\"progress-bar-drag-point\" style={{left: `calc((${currentTimeNum}/${durationNum})*100%)` }}></div>\n            </div>\n            <div className=\"audio-time-and-controls\">\n              <span className=\"current-time\">{ currentTime }</span>\n              <span className=\"duration-time\">{ duration }</span>\n            </div>\n          </div>\n        </div>\n        <div className=\"player-list\">\n          {/* 暂未实现 */}\n        </div>\n      </div>\n    )\n  }\n}\n"],"names":["Util","seconds","ss","parseInt","mm","hh","result","slice","OAudioPlayer","props","state","dPauseIcon","src","audioPlayPause","self","audioPlayerRef","current","log","duration","paused","play","pause","canplayHandle","setState","timeFormat","timeUpdateHandle","audioPlayer","ct","currentTime","dt","pauseIcon","playingIcon","progressBarClickHandle","e","ev","nativeEvent","offset","layerX","offsetX","progressBarDetail","progressBarDetailRef","barWidth","offsetWidth","curTime","durationNum","React","createRef","url","title","subtitle","loop","onPlaying","onPause","preload","autoplay","currentTimeNum","bufferedPercent","playSrc","width","left","Component","defaultProps","dPlayIcon","propTypes","PropTypes","bool","string","func"],"mappings":";;;;;;;;AAAA,SAAS,WAAW,CAAC,GAAG,EAAE,GAAG,EAAE;EAC7B,KAAK,GAAG,KAAK,KAAK,CAAC,GAAG,GAAG,GAAG,EAAE,CAAC;EAC/B,IAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC;;EAE5B,IAAI,CAAC,GAAG,IAAI,OAAO,QAAQ,KAAK,WAAW,EAAE,EAAE,OAAO,EAAE;;EAExD,IAAI,IAAI,GAAG,QAAQ,CAAC,IAAI,IAAI,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;EACrE,IAAI,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;EAC5C,KAAK,CAAC,IAAI,GAAG,UAAU,CAAC;;EAExB,IAAI,QAAQ,KAAK,KAAK,EAAE;IACtB,IAAI,IAAI,CAAC,UAAU,EAAE;MACnB,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;KAC3C,MAAM;MACL,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;KACzB;GACF,MAAM;IACL,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;GACzB;;EAED,IAAI,KAAK,CAAC,UAAU,EAAE;IACpB,KAAK,CAAC,UAAU,CAAC,OAAO,GAAG,GAAG,CAAC;GAChC,MAAM;IACL,KAAK,CAAC,WAAW,CAAC,QAAQ,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,CAAC;GACjD;CACF;;;;;ACzBD,IAAMA,OAAO;cACC,oBAASC,OAAT,EAAiB;QACvBC,KAAKC,SAASF,OAAT,CAAT,CAD2B;QAEvBG,KAAK,CAAT,CAF2B;QAGvBC,KAAK,CAAT,CAH2B;QAIvBH,KAAK,EAAT,EAAa;WACNC,SAASD,KAAK,EAAd,CAAL;WACKC,SAASD,KAAK,EAAd,CAAL;;QAEEE,KAAK,EAAT,EAAa;WACND,SAASC,KAAK,EAAd,CAAL;WACKD,SAASC,KAAK,EAAd,CAAL;;QAEEE,SAAS,CAAC,OAAOH,SAASD,EAAT,CAAR,EAAsBK,KAAtB,CAA4B,CAAC,CAA7B,CAAb;QACIH,KAAK,CAAT,EAAY;eACD,CAAC,OAAOD,SAASC,EAAT,CAAR,EAAsBG,KAAtB,CAA4B,CAAC,CAA7B,IAAkC,GAAlC,GAAwCD,MAAjD;KADF,MAEO;eACI,QAAQA,MAAjB;;QAEED,KAAK,CAAT,EAAY;eACD,CAAC,OAAOF,SAASE,EAAT,CAAR,EAAsBE,KAAtB,CAA4B,CAAC,CAA7B,IAAkC,GAAlC,GAAwCD,MAAjD;;;WAGKA,MAAP;;CAvBJ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICWqBE;;;wBAEPC,KAAZ,EAAmB;;;2HACXA,KADW;;UAoCnBC,KApCmB,GAoCX;mBACM,OADN;gBAEG,OAFH;sBAGS,CAHT;mBAIM,CAJN;uBAKU,CALV;eAMGC,IAAWC;KA1CH;;UAwDnBC,cAxDmB,GAwDF,YAAM;UACfC,OAAO,MAAKC,cAAL,CAAoBC,OAAjC;cACQC,GAAR,CAAY,cAAcH,KAAKI,QAA/B;UACIJ,KAAKK,MAAT,EAAiB;gBACPF,GAAR,CAAY,QAAZ;aACKG,IAAL;OAFF,MAGO;gBACGH,GAAR,CAAY,SAAZ;aACKI,KAAL;;KAhEe;;UAiFnBC,aAjFmB,GAiFH,YAAI;YACbC,QAAL,CAAc;qBACA,MAAKR,cAAL,CAAoBC,OAApB,CAA4BE,QAD5B;kBAEFlB,KAAKwB,UAAL,CAAgB,MAAKT,cAAL,CAAoBC,OAApB,CAA4BE,QAA5C;OAFZ;KAlFiB;;UAyFnBO,gBAzFmB,GAyFA,YAAI;UACjBC,cAAc,MAAKX,cAAL,CAAoBC,OAAtC;UACIW,KAAKD,YAAYE,WAArB;UACIC,KAAKH,YAAYR,QAArB;UACGS,MAAIE,EAAP,EAAU;cACHN,QAAL,CAAc;0BACII,EADJ;uBAEC3B,KAAKwB,UAAL,CAAgBG,EAAhB;SAFf;;;;UAOCD,YAAYP,MAAf,EAAsB;cACfI,QAAL,CAAc;mBACJ,MAAKd,KAAL,CAAWqB;SADrB;OADF,MAIK;cACEP,QAAL,CAAc;mBACJ,MAAKd,KAAL,CAAWsB;SADrB;;KA1Ge;;UAiHnBC,sBAjHmB,GAiHM,UAACC,CAAD,EAAK;UACtBC,KAAKD,EAAEE,WAAb;UACMC,SAASF,GAAGG,MAAH,IAAaH,GAAGI,OAA/B;UACMC,oBAAoB,MAAKC,oBAAL,CAA0BxB,OAApD;UACMyB,WAAWF,kBAAkBG,WAAnC;UACIC,UAAUP,SAAOK,QAAP,GAAkB,MAAK/B,KAAL,CAAWkC,WAA3C;YACKrB,QAAL,CAAc;wBACIoB,OADJ;qBAEC3C,KAAKwB,UAAL,CAAgBmB,OAAhB;OAFf;;YAKK5B,cAAL,CAAoBC,OAApB,CAA4BY,WAA5B,GAA2Ce,OAA3C;KA5HiB;;UAEZ5B,cAAL,GAAsB8B,eAAMC,SAAN,EAAtB;UACKN,oBAAL,GAA4BK,eAAMC,SAAN,EAA5B;;;;;;wCA0CkB;;;;;;;;;;;;;;;;gCAwBT;UACHhC,OAAO,KAAKC,cAAL,CAAoBC,OAAjC;WACKI,IAAL;;;;;;;iCAIU;UACJN,OAAO,KAAKC,cAAL,CAAoBC,OAAjC;WACKK,KAAL;;;;;;;;;;6BAqDO;mBAGH,KAAKZ,KAHF;UAELsC,GAFK,UAELA,GAFK;UAEAC,KAFA,UAEAA,KAFA;UAEOC,QAFP,UAEOA,QAFP;UAEiBC,IAFjB,UAEiBA,IAFjB;UAEuBC,SAFvB,UAEuBA,SAFvB;UAEkCC,OAFlC,UAEkCA,OAFlC;UAE0CC,OAF1C,UAE0CA,OAF1C;UAEkDC,QAFlD,UAEkDA,QAFlD;mBAMH,KAAK5C,KANF;UAKJQ,QALI,UAKJA,QALI;UAKKU,WALL,UAKKA,WALL;UAKiBgB,WALjB,UAKiBA,WALjB;UAK6BW,cAL7B,UAK6BA,cAL7B;UAK4CC,eAL5C,UAK4CA,eAL5C;UAK4DC,OAL5D,UAK4DA,OAL5D;;aAQLZ;;UAAK,WAAU,mBAAf;gDACS,WAAU,kBAAjB;eACO,KAAK9B,cADZ;mBAEasC,OAFb;oBAGcC,QAHd;qBAIaH,SAJb;mBAKWC,OALX;qBAMgB,KAAK9B,aANrB;wBAOmB,KAAKG,gBAPxB;eAQOsB,GARP;gBASUG,IATV,GADF;;;YAaO,WAAU,aAAf;;;cACO,WAAU,WAAf;kDACO,SAAS,KAAKrC,cAAnB,EAAmC,WAAU,gBAA7C,EAA8D,KAAM4C,OAApE;WAFJ;;;cAIO,WAAU,YAAf;;;gBACK,WAAU,aAAb;;aADF;;;gBAEK,WAAU,gBAAb;;aAFF;;;gBAGO,WAAU,yBAAf;;;kBACO,WAAU,qBAAf;2BACY,KAAKzB,sBADjB;uBAEQ,KAAKQ,oBAFb;sDAIO,WAAU,qBAAf,EAAqC,OAAO,EAAEkB,OAAOF,kBAAkB,GAA3B,EAA5C,GAJF;sDAKO,WAAU,sBAAf,EAAsC,OAAO,EAAEE,kBAAgBH,cAAhB,SAAkCX,WAAlC,YAAF,EAA7C,GALF;;;oBAMQ,WAAU,sBAAhB;yDACQ,WAAU,cAAhB;;eARN;oDAWO,WAAU,yBAAf,EAAyC,OAAO,EAACe,iBAAeJ,cAAf,SAAiCX,WAAjC,YAAD,EAAhD;aAdJ;;;gBAgBO,WAAU,yBAAf;;;kBACQ,WAAU,cAAhB;;eADF;;;kBAEQ,WAAU,eAAhB;;;;;SAnCR;8CAuCO,WAAU,aAAf;OAxCJ;;;;EA3IsCgB;;AAArBpD,aAQZqD,eAAe;aACT,qBAAM,EADG;WAEX,mBAAM,EAFK;YAGX,KAHW;QAId,KAJc;WAKZ,UALY;aAMTlD,IAAWC,GANF;eAOPkD,MAAUlD;;AAfNJ,aAkBZuD,YAAY;YACPC,UAAUC,IADH;QAEXD,UAAUC,IAFC;SAGVD,UAAUC,IAHA;;;WAMRD,UAAUE,MANF;UAOTF,UAAUE,MAPD;OAQZF,UAAUE,MARE;;SAUVF,UAAUE,MAVA;YAWPF,UAAUE,MAXH;aAYPF,UAAUE,MAZH;eAaLF,UAAUE,MAbL;;aAeNF,UAAUG,IAfJ;WAgBRH,UAAUG,IAhBF;;;;;;"}